{"version":3,"sources":["webpack:///webpack/bootstrap 8b5375d679568c611155","webpack:///./game/structs.js","webpack:///./game/node.js","webpack:///./game/logger.js","webpack:///./game/scene.js","webpack:///./game/spritenode.js","webpack:///./game/loaders/image.js","webpack:///./node_modules/event-class-es6/event-class-es6.js","webpack:///./main.js","webpack:///./game/game.js","webpack:///./game/assets.js","webpack:///./game/loaders/spritesheet.js","webpack:///./game/loaders/tmx.js","webpack:///./voxmesher/voxmesher.js","webpack:///./voxmesher/mesher.js","webpack:///./game/rectangle.js"],"names":["Position","constructor","x","y","Size","width","height","Node","id","alpha","priority","parent","children","add","node","emit","push","sort","a","b","getChildNodeById","child","remove","idx","indexOf","splice","getPosition","setPosition","position","hasOwnProperty","draw","timestamp","delta","lastDraw","game","context","save","translate","globalAlpha","restore","Logger","prefix","console","window","info","message","warn","error","log","Scene","keys","addEventListener","e","which","setColor","hexCode","color","SpriteNode","drawable","ImageAsset","image","Image","canLoad","path","drawImage","load","src","promise","Promise","resolve","reject","fullscreen","aspect","loading","Assets","on","scene","splash","setScene","Game","options","setup","canvas","document","getElementById","createElement","setAttribute","getContext","aspectHeight","aspectWidth","style","top","left","innerWidth","innerHeight","body","appendChild","fillStyle","fillRect","sceneTime","Date","now","outgoingScene","drawScene","requestAnimationFrame","bind","items","loaders","logger","count","Object","length","loaded","itemLoaded","item","total","Loader","then","SpriteSheet","dom","domPath","loadSheet","data","callback","fail","textureAtlas","querySelector","getAttribute","basepath","split","pop","join","alt","replace","subTextures","querySelectorAll","subTexture","name","sheet","loadImage","fetch","response","text","str","DOMParser","parseFromString","TMX","lastRender","loadMap","map","tileSets","tileSetsLoaded","paths","mapProperties","property","value","isNaN","parseInt","layers","tiles","dummy","layerNodes","layerNode","textContent","tileToPosition","tile","tileSize","tilesPerRow","Math","floor","tileSet","sprites","tileHeight","tileWidth","columns","tileNodes","tileNode","properties","spritesheet","filepath","orthogonal","screenPosition","tilewidth","tileheight","isometric","render","size","OffscreenCanvas","layer","tileIdx","tileCoordinates","orientation","VoxMesher","mesher","Mesher","voxelRectangle","fill","border","mask","chunkSize","random","voxel","greedy","time","quads","quadWidth","quadHeight","next","lineMatch","l","quad","mx","my","i","delay","update","Rectangle","borderSize","strokeStyle","lineWidth","strokeRect"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8b5375d679568c611155","class Position {\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n}\n\nclass Size {\n    constructor(width, height) {\n        this.width = width;\n        this.height = height;\n    }\n}\n\nexport { Position, Size };\n\n\n// WEBPACK FOOTER //\n// ./game/structs.js","import { Position } from \"./structs.js\";\nimport EventClass from \"event-class-es6\";\n\nclass Node extends EventClass {\n    constructor() {\n        super();\n        Node.id = Node.id || 0;\n        this.id = Node.id++;\n        this.x = 0;\n        this.y = 0;\n        this.alpha = 1.0;\n        this.priority = 0;\n        this.parent = null;\n        this.children = [];\n    }\n\n    add(node) {\n        node.parent = this;\n        node.emit(\"added\", this);\n        this.children.push(node);\n        this.children.sort((a, b) => a.priority > b.priority);\n    }\n\n    getChildNodeById(id) {\n        for(var child of this.children) {\n            if(child.id === id) {\n                return child;\n            }\n        }\n    }\n\n    remove(node) {\n        let idx = this.children.indexOf(node);\n        if(idx !== -1) {\n            this.children[idx].parent = null;\n            this.children.splice(idx, 1);\n        }\n    }\n\n    getPosition() {\n        return new Position(this.x, this.y);\n    }\n\n    setPosition(position, y) {\n        this.x = position.hasOwnProperty(\"x\") ? position.x : position;\n        this.y = position.hasOwnProperty(\"y\") ? position.y : y;\n    }\n\n    draw(timestamp) {\n        var delta = timestamp - (this.lastDraw || timestamp);\n        Node.game.context.save();\n        Node.game.context.translate(this.x, this.y);\n        Node.game.context.globalAlpha = this.alpha;\n        for(let child of this.children) {\n            child.draw(timestamp);                \n        }\n        Node.game.context.restore();\n        this.emit(\"update\", delta);\n        this.lastDraw = timestamp;\n    }\n}\n\nexport default Node;\n\n\n// WEBPACK FOOTER //\n// ./game/node.js","class Logger {\n    constructor(prefix) {\n        this.prefix = prefix;\n        this.console = window.console;\n    }\n\n    info(message) {    \n        this.console.info(\"%c\" + this.prefix + \"%c%s\", \"color: blue\", \"color: black\", message);\n    }\n\n    warn(message) {\n        this.console.warn(\"%c\" + this.prefix + \"%c%s\", \"color: blue\", \"color: orange\", message);\n    }\n\n    error(message) {\n        this.console.error(message);\n    }\n\n    log(message) {\n        this.info(message);\n    }\n}\n\nexport default Logger;\n\n\n// WEBPACK FOOTER //\n// ./game/logger.js","import Node from \"./node.js\";\n\nclass Scene extends Node {\n    constructor() {\n        super();\n        this.keys = {\n            32: \"space\",\n            37: \"left\",\n            39: \"right\"\n        };\n        window.addEventListener(\"keydown\", (e) => {\n            if(this.keys[e.which]) {\n                this.emit(`${this.keys[e.which]}-down`);\n            }\n        });\n        window.addEventListener(\"keyup\", (e) => {\n            if(this.keys[e.which]) {\n                this.emit(`${this.keys[e.which]}-up`);\n            }\n        });\n    }\n\n    setColor(hexCode) {\n        this.color = hexCode;\n    }\n}\n\nexport default Scene;\n\n\n// WEBPACK FOOTER //\n// ./game/scene.js","import { Position } from \"./structs.js\";\nimport Node from \"./node.js\";\n\nclass SpriteNode extends Node {\n    constructor(drawable) {\n        super();\n        this.drawable = drawable;\n    }\n\n    get width() {\n        return this.drawable.width;\n    }\n\n    get height() {\n        return this.drawable.height;\n    }\n\n    draw() {\n        this.drawable.draw(this.x, this.y);\n        super.draw();\n    }\n}\n\nexport default SpriteNode;\n\n\n// WEBPACK FOOTER //\n// ./game/spritenode.js","class ImageAsset {\n    constructor(context, image) {\n        this.context = context;\n        this.image = image || new Image();\n    }\n\n    static canLoad(path) {\n        if(path.indexOf(\".png\") !== -1) {\n            return true;\n        }\n        return false;\n    }\n\n    get width() {\n        return this.image.width;\n    }\n\n    get height() {\n        return this.image.height;\n    }\n\n    draw(x, y) {\n        this.context.drawImage(this.image, x, y);\n    }\n    \n    load(path) {\n        this.image.src = path;\n        let promise = new Promise((resolve, reject) => {\n            this.image.addEventListener(\"load\", resolve);\n            this.image.addEventListener(\"error\", reject);                \n        });\n        return promise;\n    }\n}\n\nexport default ImageAsset;\n\n\n// WEBPACK FOOTER //\n// ./game/loaders/image.js","let _listeners = Symbol(\"listeners\");\n\nexport default class EventClass {\n\n    constructor() {\n        this[_listeners] = {};\n    }\n\n    /**\n     * Adds a listener for the given event\n     * @param {string} event - the event to listen to\n     * @param {function} listener - the callback called when the given event is emitted\n     * @returns {function} - event.off(event, listener);\n     */\n    on(event, listener) {\n        if (typeof this[_listeners][event] === \"undefined\") {\n            this[_listeners][event] = [];\n        }\n        this[_listeners][event].push(listener);\n        return listener;\n    }\n\n    /**\n     * Adds an one-shot listener for the given event\n     * @param {string} event - the event to listen to\n     * @param {function} listener - the callback called once when the given event is emitted\n     */\n    once(event, listener) {\n        let onceListener = () => {\n            listener();\n            this.off(event, onceListener);\n        };\n        this.on(event, onceListener);\n    }\n\n    /**\n     * Removes the listener for the given event, or removes all listeners for the given event if listener is undefined\n     * @param {string} event\n     * @param {function} [listener]\n     */\n    off(event, listener) {\n        if (typeof this[_listeners][event] !== \"undefined\") {\n            if (typeof listener === \"undefined\") {\n                this[_listeners][event] = [];\n            } else {\n                let listenerIndex = this[_listeners][event].lastIndexOf(listener);\n                if (listenerIndex !== -1) {\n                    this[_listeners][event].splice(listenerIndex, 1);\n                }\n            }\n        }\n    }\n\n    /**\n     * Emits an event\n     * @param {string} event - all listeners to this event will be notified\n     * @param {...*} arguments - all listeners to this event will be notified with the given arguments\n     */\n    emit(event) {\n        let listeners = this[_listeners][event];\n        if (typeof listeners !== \"undefined\") {\n            for (let i = 0; i < listeners.length; i++) {\n                listeners[i].apply(this, Array.prototype.slice.call(arguments, 1));\n            }\n        }\n    }\n\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/event-class-es6/event-class-es6.js\n// module id = 6\n// module chunks = 0","import Game from \"./game/game.js\";\nimport VoxMesher from \"./voxmesher/voxmesher.js\";\n\n\n\nlet game = new Game({ width: 620, height: 620, fullscreen: false, aspect: \"width\" });\n\nlet loading = new game.Assets({\n    \"splash\": \"assets/armen138splash_small.png\"\n});\n\nloading.on(\"ready\", () => {\n    let scene = new game.Scene(loading);\n    let splash = new game.SpriteNode(loading.splash);\n    scene.setColor(\"#1e3966\");\n    splash.setPosition(game.width / 2 - splash.width / 2, game.height / 2 - splash.height / 2);\n    scene.add(splash);\n    game.setScene(scene);\n    new VoxMesher(game);\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ./main.js","import Assets from \"./assets.js\";\nimport { Position, Size } from \"./structs.js\";\nimport Scene from \"./scene.js\";\nimport Node from \"./node.js\";\nimport SpriteNode from \"./spritenode.js\";\n\n/**\n * Game Class\n * @constructor\n * @param size { width, height }\n * @param fullscreen boolean\n */\nclass Game {\n    constructor(options) {\n        this.Position = Position;\n        this.Size = Size;\n        this.Node = Node;\n        this.Scene = Scene;\n        this.SpriteNode = SpriteNode;\n        this.Assets = Assets;\n        this.Assets.game = this;\n        this.Node.game = this;\n        this.setup(options);\n        this.draw();\n    }\n\n    setup(options) {\n        this.canvas = document.getElementById(\"game\") || document.createElement(\"canvas\");\n        this.canvas.setAttribute(\"id\", \"game\");\n        this.context = this.canvas.getContext(\"2d\");\n        this.canvas.width = options.width;\n        this.canvas.height = options.height;\n        if(options.fullscreen) {\n            let aspectHeight = 0,\n                aspectWidth = 0;\n            this.canvas.style.position = \"fixed\";\n            this.canvas.style.top = \"0\";\n            this.canvas.style.left = \"0\";\n            this.canvas.style.width = window.innerWidth + \"px\";\n            this.canvas.style.height = window.innerHeight + \"px\";\n            if(options.aspect) {\n                switch(options.aspect) {\n                    case \"width\":\n                    aspectHeight = window.innerHeight / (window.innerWidth / options.width);\n                    this.canvas.height = aspectHeight;\n                    break;\n                    case \"height\":\n                    aspectWidth = window.innerWidth / (window.innerHeight / options.height);\t\t\t\t\t\n                    this.canvas.width = aspectWidth;\n                    break;\n                    case \"fit\":\n                    aspectHeight = window.innerHeight / (window.innerWidth / options.width);\n                    aspectWidth = window.innerWidth / (window.innerHeight / options.height);\n                    this.canvas.width = aspectWidth;\n                    this.canvas.height = aspectHeight;\n                    break;\n                    case \"stretch\":\n                    break;\n                }\n            }\n        }\n        if(!document.getElementById(\"game\")) {\n            document.body.appendChild(this.canvas);\n        }\n        this.context.fillStyle = \"rgba(0, 0, 0, 1.0)\";\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n\n        this.scene = null;\n    }\n\n    get width() {\n        return this.canvas.width;\n    }\n\n    get height() {\n        return this.canvas.height;\n    }\n\n    setScene(scene) {\n        this.sceneTime = Date.now();\n        this.outgoingScene = this.scene;\n        this.scene = scene;\n    }\n\n    drawScene(scene, timestamp) {\n        if(scene) {\n            let color = scene.color || \"black\";\n            this.context.fillStyle = color;\n            this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n            scene.draw(timestamp);            \n        }\n    }\n    draw(timestamp) {\n        let now = Date.now();\n        let alpha = 1.0;\n        if(now - this.sceneTime < 1000) {\n            alpha = (now - this.sceneTime) / 1000.0;\n        } else {\n            this.outgoingScene = null;\n        }\n        this.context.globalAlpha = alpha;\n        this.drawScene(this.scene, timestamp);\n        if(this.outgoingScene) {\n            this.context.globalAlpha = (1.0 - alpha);\n            this.drawScene(this.outgoingScene, timestamp);\n        }        \n        requestAnimationFrame(this.draw.bind(this));\n    }\n}\n\nexport default Game;\n\n\n// WEBPACK FOOTER //\n// ./game/game.js","import ImageAsset from \"./loaders/image.js\";\nimport SpriteSheet from \"./loaders/spritesheet.js\";\nimport TMX from \"./loaders/tmx.js\";\nimport Logger from \"./logger.js\";\nimport EventClass from \"event-class-es6\";\n\nclass Assets extends EventClass {\n    constructor(items) {\n        super();\n        this.loaders = [ ImageAsset, SpriteSheet, TMX ];\n        this.logger = new Logger(\"assets\");\n        this.count = Object.keys(items).length;\n        this.loaded = 0;\n        if(items) {\n            this.load(Assets.game.context, items);            \n        }\n    }\n\n    itemLoaded(item) {\n        this.loaded++;\n        this.emit(\"progress\", { item: item, loaded: this.loaded, total: this.count });\n        if(this.count === this.loaded) {\n            this.emit(\"ready\", this);\n        }\n    }\n\n    load(context, items) {\n        for(let item in items) {\n            for(let Loader of this.loaders) {\n                if(Loader.canLoad(items[item])) {\n                    this[item] = new Loader(context);\n                    this[item].load(items[item]).then(() => {\n                        this.itemLoaded(item);\n                    });    \n                }                    \n            }\n        }\n    }\n}\n\nexport default Assets;\n\n\n// WEBPACK FOOTER //\n// ./game/assets.js","import Logger from \"../logger.js\";\n\nclass SpriteSheet {\n    constructor(context) {\n        this.context = context;\n        this.dom = null;\n        this.domPath = null;\n        this.image = new Image();\n        this.logger = new Logger(\"spritesheet\");\n    }\n    static canLoad(path) {\n        return path.indexOf(\".xml\") !== -1;\n    }\n    loadSheet(data, callback, fail) {\n        this.dom = data;\n        let textureAtlas = data.querySelector(\"TextureAtlas\");\n        var path = textureAtlas.getAttribute(\"imagePath\");\n        var basepath = this.domPath.split(\"/\");\n        basepath.pop();\n        basepath.push(path);\n        path = basepath.join(\"/\");\n        var alt = this.domPath.replace(\".xml\", \".png\");\n\n\n        let subTextures = textureAtlas.querySelectorAll(\"SubTexture\");\n        for(var subTexture in subTextures) {\n            if(subTextures[subTexture].getAttribute) {\n                let name = subTextures[subTexture].getAttribute(\"name\");\n                this[name] = {};\n                this[name].sheet = this;\n                this[name].width = subTextures[subTexture].getAttribute(\"width\");\n                this[name].height = subTextures[subTexture].getAttribute(\"height\");\n                this[name].x = subTextures[subTexture].getAttribute(\"x\");\n                this[name].y = subTextures[subTexture].getAttribute(\"y\");\n                this[name].draw = function(x, y) {\n                    //void ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n                    this.sheet.context.drawImage(this.sheet.image, this.x, this.y, this.width, this.height, x, y, this.width, this.height);\n                }.bind(this[name]);    \n            }\n        }\n\n        var loadImage = (path) => {\n            new Promise((resolve, reject) => {\n                this.image.src = path;\n                this.image.addEventListener(\"load\", resolve);\n                this.image.addEventListener(\"error\", reject);\n            }).then(() => {\n                callback();\n            }, () => {\n                if(path !== alt) {\n                    this.logger.warn(`Failed to load ${path}, trying ${alt}`);\n                    loadImage(alt);\n                } else {\n                    this.logger.error(`Failed to load sprite sheet for ${this.domPath}`);\n                    fail();\n                }\n            });\n        };\n        loadImage(path);\n\n        // console.log(path);\n    }\n    load(path) {\n        this.domPath = path;\n        let promise = new Promise((resolve, reject) => {       \n            fetch(path).then(response => response.text())\n                .then(str => (new window.DOMParser()).parseFromString(str, \"text/xml\"))\n                .then(data => this.loadSheet(data, resolve, reject));\n        });\n        // this.image.src = path.replace(\".xml\", \".png\");\n        // let promise = new Promise((resolve, reject) => {\n        //     this.image.addEventListener(\"load\", resolve);\n        //     this.image.addEventListener(\"error\", reject);\n        // });\n        return promise;\n    }\n}\n\nexport default SpriteSheet;\n\n\n// WEBPACK FOOTER //\n// ./game/loaders/spritesheet.js","import Logger from \"../logger.js\";\nimport ImageAsset from \"./image.js\";\nimport { Position, Size } from \"../structs.js\";\n\nclass TMX {\n    constructor(context) {\n        this.context = context;\n        this.dom = null;\n        this.domPath = null;\n        this.image = {};\n        this.lastRender = null;\n        this.logger = new Logger(\"TMX\");\n    }\n    static canLoad(path) {\n        return path.indexOf(\".tmx\") !== -1;\n    }\n    loadMap(data, callback, fail) {\n        this.dom = data;\n        let map = data.querySelector(\"map\");\n        let tileSets = map.querySelectorAll(\"tileset\");\n        let tileSetsLoaded = 0;\n        let paths = [];\n\n        let mapProperties = [ \"height\", \"width\", \"orientation\", \"renderorder\", \"tiledversion\", \"tileheight\", \"tilewidth\" ];\n        \n        for(let property of mapProperties) {\n            let value = map.getAttribute(property);\n            this[property] = isNaN(parseInt(value, 10)) ? value : parseInt(value, 10); //map.getAttribute(property);\n            this.logger.info(`map property: ${property} = ${this[property]}`);\n        }\n\n        this.layers = [];\n        this.tiles = [ { dummy: \"dummy\" }];\n        let layerNodes = map.querySelectorAll(\"layer\");\n        for(let layerNode of layerNodes) {\n            this.layers.push({\n                name: layerNode.getAttribute(\"name\"),\n                width: layerNode.getAttribute(\"width\"),\n                height: layerNode.getAttribute(\"height\"),\n                tiles: layerNode.querySelector(\"data\").textContent.split(\",\")\n            });\n        }\n\n\n        let tileToPosition = function(tile, tileSize, tilesPerRow) {\n            let position = new Position();\n            position.y = Math.floor(tile / tilesPerRow) * (tileSize.height);\n            position.x = (tile % tilesPerRow) * (tileSize.width); \n            return position;\n        };\n        for(let tileSet of tileSets) {\n            let image = map.querySelector(\"image\");\n            let sprites = image.getAttribute(\"source\");\n            // let sheetWidth = parseInt(image.getAttribute(\"width\"), 10);\n            let tileHeight = parseInt(tileSet.getAttribute(\"tileheight\"), 10);\n            let tileWidth = parseInt(tileSet.getAttribute(\"tilewidth\"), 10);\n            let columns = parseInt(tileSet.getAttribute(\"columns\"), 10);\n            // let sheetHeight = parseInt(image.getAttribute(\"height\"), 10);\n            paths.push(sprites);\n            let tileNodes = tileSet.querySelectorAll(\"tile\");\n            for(let tileNode of tileNodes) {\n                let tile = {};\n                let properties = tileNode.querySelectorAll(\"property\");\n                for(let property of properties) {\n                    let value = property.getAttribute(\"value\");\n                    tile[property.getAttribute(\"name\")] = property.getAttribute(\"type\") === \"int\" ? parseInt(value, 10) : value;\n                }\n                let id = parseInt(tileNode.getAttribute(\"id\"), 10);\n                let position = tileToPosition(id - 1, new Size(tileWidth, tileHeight), columns);\n                tile.width = tileWidth;\n                tile.height = tileHeight;\n                tile.spritesheet = sprites;\n                tile.x = position.x;\n                tile.y = position.y;\n                this.tiles[id] = tile;\n            }    \n        }\n\n        var loadImage = (path) => {\n            var basepath = this.domPath.split(\"/\");\n            basepath.pop();\n            basepath.push(path);\n            let filepath = basepath.join(\"/\");\n            var alt = this.domPath.replace(\".xml\", \".png\");\n    \n            this.logger.info(filepath);\n    \n            new Promise((resolve, reject) => {\n                this.image[path] = new Image();\n                this.image[path].src = filepath;\n                this.image[path].addEventListener(\"load\", resolve);\n                this.image[path].addEventListener(\"error\", reject);\n            }).then(() => {\n                tileSetsLoaded++;\n                this.logger.info(`Loaded tile set ${path}`);\n                if(tileSetsLoaded == tileSets.length) {\n                    callback();\n                }\n            }, () => {\n                if(path !== alt) {\n                    this.logger.warn(`Failed to load ${path}, trying ${alt}`);\n                    loadImage(alt);\n                } else {\n                    this.logger.error(`Failed to load sprite sheet for ${this.domPath}`);\n                    fail();\n                }\n            });\n        };\n        for(let path of paths) {\n            loadImage(path);\n        }\n    }\n\n    orthogonal(position) {\n        let screenPosition = new Position();\n        screenPosition.x = position.x * this.tilewidth;\n        screenPosition.y = position.y * this.tileheight;\n        return screenPosition;\n    }\n    isometric(position) {\n        let screenPosition = new Position();\n        screenPosition.x = position.x * (this.tilewidth / 2) - (position.y * (this.tilewidth / 2)) + (this.width / 2 * this.tilewidth) - (this.tilewidth / 2);\n        screenPosition.y = position.y * (this.tileheight / 2) + (position.x * (this.tileheight /2)) - (this.tileheight / 2);\n        return screenPosition;\n    }\n\n    render(position, size) {\n        //ignore args :)\n        this.logger.info(\"rendering map to image\");\n        let canvas = null;\n        //futureproof\n        if(window.OffscreenCanvas) {\n            canvas = new OffscreenCanvas(size.width, size.height);\n        } else {\n            canvas = document.createElement(\"canvas\"); \n            canvas.width = size.width;\n            canvas.height = size.height;                \n        }\n        document.createElement(\"canvas\"); \n        let context = canvas.getContext(\"2d\");\n        for(let layer of this.layers) {\n            this.logger.info(`render layer ${layer.name}`);\n            for(let tileIdx in layer.tiles) {\n                let tile = this.tiles[layer.tiles[tileIdx]];\n                let tileCoordinates = new Position(tileIdx % this.width, tileIdx / this.width | 0);\n                // currently supported orientations: isometric, orthogonal\n                let position = this[this.orientation](tileCoordinates);\n                //position.x += (size.width / 2);\n                if(tile.spritesheet) {\n                    this.logger.info(\"render tile\");\n                    context.drawImage(this.image[tile.spritesheet], tile.x, tile.y, tile.width, tile.height, position.x, position.y, tile.width, tile.height);\n                }\n            }\n        }\n        this.lastRender = new ImageAsset(this.context, canvas);\n        return this.lastRender;\n    }\n    load(path) {\n        this.domPath = path;\n        let promise = new Promise((resolve, reject) => {       \n            fetch(path).then(response => response.text())\n                .then(str => (new window.DOMParser()).parseFromString(str, \"text/xml\"))\n                .then(data => this.loadMap(data, resolve, reject));\n        });\n        return promise;\n    }\n}\n\nexport default TMX;\n\n\n// WEBPACK FOOTER //\n// ./game/loaders/tmx.js","import Node from \"../game/node.js\";\nimport Scene from \"../game/scene.js\";\nimport { Size, Position } from \"../game/structs.js\";\nimport SpriteNode from \"../game/spritenode.js\";\nimport Mesher from \"./mesher.js\";\nclass VoxMesher {\n    constructor(game) {\n        let mesher = new Mesher(game);\n        game.setScene(mesher);\n    }\n}\n\nexport default VoxMesher;\n\n\n// WEBPACK FOOTER //\n// ./voxmesher/voxmesher.js","import Node from \"../game/node.js\";\nimport Scene from \"../game/scene.js\";\nimport { Size, Position } from \"../game/structs.js\";\nimport Rectangle from \"../game/rectangle.js\";\nimport SpriteNode from \"../game/spritenode.js\";\n\nclass Mesher extends Scene {\n    constructor(game) {\n        super();\n        this.size = new Size(Node.game.width, Node.game.height);\n        let voxelRectangle = new Rectangle(game.context, 100, 100);\n        voxelRectangle.fill = \"#444\";\n        voxelRectangle.border = \"white\";\n        let mask = [];\n        let chunkSize = { width: 6, height: 6 };\n        for (let x = 0; x < chunkSize.width; x++) {\n            mask.push([]);\n            for (let y = 0; y < chunkSize.height; y++) {\n                mask[x].push(Math.random() < 0.75 ? true : false);\n                if (mask[x][y]) {\n                    let voxel = new SpriteNode(voxelRectangle);\n                    this.add(voxel);\n                    voxel.setPosition(10 + x * 100, 10 + y * 100);\n                }\n            }\n        }\n        this.chunkSize = chunkSize;\n        this.mask = mask;\n        this.on(\"space-down\", this.greedy);\n        this.context = game.context;\n    }\n\n    greedy() {\n        console.log(\"getting greedy\");\n        let time = Date.now();\n        let quads = [];\n        let x = 0, y = 0;\n        while (y < this.chunkSize.height) {\n            if (this.mask[x][y]) {\n                let quadWidth = 1;\n                let quadHeight = 1;\n                let next = x + 1;\n                while (next < this.chunkSize.width) {\n                    if (this.mask[next][y]) {\n                        quadWidth++;\n                    } else {\n                        break;\n                    }\n                    next++;\n                }\n                next = y + 1;\n                let lineMatch = true;\n                while (next < this.chunkSize.height && lineMatch) {\n                    for (let l = 0; l < quadWidth; l++) {\n                        if (!this.mask[x + l][next]) {\n                            lineMatch = false;\n                        }\n                    }\n                    if (lineMatch) {\n                        quadHeight++;\n                        next++;\n                    }\n                }\n                let quad = { x: x, y: y, width: quadWidth, height: quadHeight };\n                quads.push(quad);\n                for (let mx = x; mx < x + quadWidth; mx++) {\n                    for (let my = y; my < y + quadHeight; my++) {\n                        this.mask[mx][my] = false;\n                    }\n                }\n                x += quadWidth;\n                if (x >= this.chunkSize.width) {\n                    x = 0;\n                    y++;\n                }\n\n            } else {\n                x++;\n                if (x >= this.chunkSize.width) {\n                    x = 0;\n                    y++;\n                }\n            }\n        }\n        for(let i = 0; i < quads.length; i++) {\n            let voxelRectangle = new Rectangle(this.context, 100 * quads[i].width, 100 * quads[i].height);\n            voxelRectangle.fill = \"rgba(0, 0, 0, 0.75)\";\n            voxelRectangle.border = \"white\";\n            let voxel = new SpriteNode(voxelRectangle);\n            this.add(voxel);\n            voxel.setPosition(10 + quads[i].x * 100, 10 + quads[i].y * 100);\n        }\n        let delay = Date.now() - time;\n        console.log(`Meshed in ${delay}ms`);\n        return quads;\n    }\n\n    update() {\n    }\n\n}\n\nexport default Mesher;\n\n\n// WEBPACK FOOTER //\n// ./voxmesher/mesher.js","class Rectangle {\n    constructor(context, width, height) {\n        this.context = context;\n        this.width = width || 100;\n        this.height = height || 100;\n        this.fill = \"red\";\n        this.border = \"green\";\n        this.borderSize = 4;\n        // this.image = image || new Image();\n    }\n\n    draw(x, y) {\n        this.context.save();\n        this.context.fillStyle = this.fill;\n        this.context.strokeStyle = this.border;\n        this.context.lineWidth = this.borderSize;\n        this.context.fillRect(x, y, this.width, this.height);\n        this.context.strokeRect(x - this.borderSize / 2, y - this.borderSize / 2, this.width, this.height);\n        this.context.restore();\n    }\n}\n\nexport default Rectangle;\n\n\n// WEBPACK FOOTER //\n// ./game/rectangle.js"],"sourceRoot":""}